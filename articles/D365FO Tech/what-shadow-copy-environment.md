---
title: Dynamics 365 Finance and Operations の調査に用いるシャドウコピー環境について
date: 2022-10-24
tags:
  - D365FO
  - Tech
  - Information
disableDisclaimer: false
---

こんにちは、Dynamics ERP サポートチームの永吉です。

この記事では、Microsoft が Dynamics 365 Finance and Operations の調査に用いるシャドウコピー環境についてご案内いたします。
<!-- more -->

## はじめに  
Microsoft は Dynamics 365 Finance and Operaitons のサポートサービスにおける調査の一環として、事象の再現及びトラブルシュートを実施する環境を用意する必要があります。この時、Shadow Copy Environment (シャドウコピー環境) を作成することで、よりスムーズに調査を進めることが可能となります。この記事ではシャドウコピー環境の機能や性質をご紹介いたします。

## お客様のプライバシーの尊重
Microsoft はお客様のプライバシーを尊重し、シャドウコピー環境に関する同意をお客様にて管理できるようにします。Mictosoft はお客様の同意なしにお客様のデータにアクセスしたり、お客様の環境を複製したりすることは決してございません。サポートリクエストを起票いただく際の事象説明欄に 「**シャドウコピー環境の作成に同意する旨**」 と 「**シャドウコピー環境を作成するソース環境**」 を記載いただくことで、問題解決時間の遅延をなくし、問題解決を迅速化することができます。同意は一時的なものであり、Microsoft のサポートチームに連絡することでいつでも取り消すことができます。

## シャドウコピー環境とは
シャドウコピー環境とは、 Microsoft サポートチームが専用テナント内に作成する環境のレプリカです。シャドウコピー環境を試用して、お客様の本番環境やビジネスオペレーションに影響を与えることなく、問題を再現して解決します。  
シャドウコピー環境について知っておいていただきたいことがいくつかあります。  
 * シャドウコピー環境を作成するために別の環境を購入する必要はありません
 * シャドウコピー環境のデータベースサイズはお客様のストレージ上限に影響しません
 * シャドウコピー環境は、ソース環境と同じ地域にあります
 * シャドウコピー環境へのアクセスおよび使用は監査されています
 * シャドウコピー環境はサポートリクエストの問題解決を迅速化するためだけに使用されます

## シャドウコピー環境を作成できるソース環境
シャドウコピー環境のソース環境は Microsoft が管理している環境のみとなります。
 * シャドウコピー環境の作成が可能な環境
   * クラウドの本番環境
   * 既存の Tier 2 環境
   *  Tier 5 環境などの追加で購入いただいた環境
 * シャドウコピー環境の作成が不可能な環境
   * LCS で作成したクラウドホスト環境
   * VHD から作成した Hyper-V 環境
   * オンプレミスの本番環境および検証環境

## シャドウコピー環境に含まれるデータ
シャドウコピー環境は、ソース環境の全てのデータとカスタマイズが含まれています。  
例外として、以下のデータは含まれていません。
 * LogisticsElectronicAddress テーブルの E メールアドレス
 * BatchJobHistory, BatchHistory, BatchConstraintHistory テーブルのバッチジョブ履歴
 * SysEmailParameters テーブルの SMTP リレーサーバー
 * PrintMgmtSettings, PrintMgmtDocInstance テーブルのプリント管理設定
 * SysServerConfig, SysServerSessions, SysCorpNetPrinters, SysClientSessions, BatchServerConfig, BatchServerGroup テーブルの環境固有レコード
 * DocuValue テーブルの添付文書。これらの添付文書には、ソース環境で上書きされた Microsoft Office テンプレートが含まれます

## シャドウコピー環境にアクセス権を持つユーザー
シャドウコピー環境は、Microsoft の問題解決に寄与する個人にアクセスが制限されます。

## シャドウコピー環境の技術的制限
シャドウコピー環境にはお客様のビジネスオペレーションに影響を与えず、安全に調査を進めるために以下の制限があります。
 * 管理者を除くすべてのユーザーは無効に設定されます
 * 管理者ユーザーはシャドウコピー環境を作成したユーザーに設定されます
 * すべてのバッチジョブが保留のステータスに設定されます
 * すべてのユーザーのパーティション値が「初期」パーティションレコード ID にリセットされます
 * Microsoft で暗号化されたすべてのフィールドは別のデータベースサーバーでは復号化できないためクリアされます。例として、SysEmailSMTPPassword テーブルのパスワードフィールドが挙げられます
 * シャドウコピー環境自体のバージョンをアップデートすることはできません
 * シャドウコピー環境にアクセスするユーザーはセキュリティで保護された専用のワークステーションからアクセスします

## Microsoft のシャドウコピー環境に対するデータアクセスの方法
 * オンライン (アプリ経由) : システム管理者権限と同等
 * データベース (SQL クエリツール経由) : すべてのテーブルへの読み取り/書き込みアクセス
   * データベースへのアクセスには、Microsoft 内部における追加の承認が必要であり、必要に応じて管理・制御・付与されます。
   * データベースへのアクセスは、標準のジャスト インタイム アクセス制御の対象となります。例えば、アクセスは時間制限され自動的に期限切れになります。

## シャドウコピー環境が維持される期間
シャドウコピー環境は、作成から 7 日後またはサポートリクエストが解決された時点で期限切れになります。また、お客様が同意を取り消された時点で期限切れになります。

## おわりに
以上、Microsoft が Dynamics 365 Finance and Operations の調査に用いるシャドウコピー環境について紹介いたしました。  
より詳細な情報が必要な場合、弊社テクニカルサポート, Customer Success Account Manager (CSAM), Customer Engineer (CE) までお問い合わせください。